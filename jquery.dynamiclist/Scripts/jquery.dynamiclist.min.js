(function(n){var t={init:function(i){return i=n.extend({},n.fn.dynamiclist.defaults,i),this.each(function(){var r=n(this),h=r.data("dynamiclist"),s,f,u,o,e;h||(r.wrap("<div class='dynamic-list-container ui-widget ui-widget-content ui-corner-all'><\/div>"),r.addClass("dynamic-list"),i.selector=r.selector,i.listType=="table"&&(n("thead tr",r).append("<th><\/th>"),n("tbody tr",r).append("<td class='delete-cell'><\/td>"),n("tfoot tr",r).append("<td><\/td>")),n(i.itemSelector,r).each(function(r){var u=t._getIndexName(i.htmlFieldPrefix,i.property);t._appendRemoveAndIndex(n(this),r,u,i.removeLabel,i._mobile,i.listType,i.itemRemoved)}),i.listType=="table"?(s=r.find("thead td, thead th").length,f=r.find("tfoot"),f.length==0&&(r.append("<tfoot><\/tfoot>"),f=r.find("tfoot")),f.append('<tr><td colspan="'+s+'" class="add-item-container ui-widget-header ui-corner-bottom"><button class="add-item">'+(i.addLabel||"")+"<\/button><\/td><\/tr>")):r.append('<li class="add-item-container ui-widget-header ui-corner-bottom" data-role="list-divider"><button class="add-item">'+(i.addLabel||"")+"<\/button><\/li>"),i._mobile&&(r.attr("data-inset","true"),r.listview()),u=r.find(".add-item"),o=i.addLabel!=null&&i.addLabel!="",i._mobile?u.buttonMarkup({icon:"plus",iconpos:o?"left":"notext"}):(e={icons:{primary:"ui-icon-new ui-icon-circle-plus"}},o?e.label=i.addLabel:e.text=!1,u.button(e)),u.click(function(){n(this).button("disable");var e=t._getNewIndex(r,i.itemSelector),o=t._getNewItemPrefix(i.htmlFieldPrefix,i.property,e),f=i.newItemUrl;return f.indexOf("?")<0&&(f+="?"),n.get(f+"&htmlFieldPrefix="+o,function(f){var s,o,h;i.listType=="table"?(r.find("tbody").append(f),r.find(i.itemSelector+":last").append("<td class='delete-cell'>")):(s=r.find(i.itemSelector+":last"),s.length>0?s.after(f):r.prepend(f)),o=n(i.itemSelector+":last",r),h=t._getIndexName(i.htmlFieldPrefix,i.property),t._appendRemoveAndIndex(o,e,h,i.removeLabel,i._mobile,i.listType,i.itemRemoved),n.validator&&n.validator.unobtrusive&&n.validator.unobtrusive.parseDynamicContent&&n.validator.unobtrusive.parseDynamicContent(o),i._mobile&&(n(n.mobile.textinput.prototype.options.initSelector,o).textinput(),r.listview("refresh")),i.itemAdded&&i.itemAdded(o),u.button("enable")}).error(function(n){n.status==401&&alert("Your session has timed out. Please refresh the page and try again.")}),!1}),r.data("dynamiclist",i))})},_appendRemoveAndIndex:function(t,i,r,u,f,e,o){var l='<button type="button" class="delete-item">'+(u||"")+"<\/button>",a='<input type="hidden" name="'+r+'" class="index" value="'+i+'" />',s=l+a,h,c;e=="table"?t.find("td.delete-cell").append(s):t.append(s),n(".delete-item",t).click(function(){t.remove(),o&&o(t)}),h=u!=null&&u!="",f?n(".delete-item",t).buttonMarkup({icon:"delete",iconpos:"notext",inline:"true"}):(c={text:h,label:u,icons:{primary:"ui-icon-delete ui-icon-trash"}},n(".delete-item",t).button(c))},_getBaseItemPrefix:function(n,t){var i=n;return i!=""&&(i+="."),i+=t},_getNewItemPrefix:function(n,i,r){return t._getBaseItemPrefix(n,i)+"["+r+"]"},_getIndexName:function(n,i){return t._getBaseItemPrefix(n,i)+".Index"},_getNewIndex:function(t,i){var u=n(i,t),r;return u.length==0?0:(r=0,u.each(function(){var t=parseInt(n("input.index",n(this)).val());isNaN(t)&&(t=0),r=Math.max(r,t)}),r+1)},options:function(t){return this.each(function(){var i=n(this),r=i.data("dynamiclist")||{};t=n.extend({},r,t),i.dynamiclist("destroy").dynamiclist("init",t)})},add:function(){return this.each(function(){var t=n(this);t.find(".add-item").click()})},destroy:function(){return this.each(function(){var t=n(this);t.removeData("dynamiclist")})}};n.fn.dynamiclist=function(i){if(t[i])return t[i].apply(this,Array.prototype.slice.call(arguments,1));if(typeof i!="object"&&i)n.error("Method "+i+" does not exist on jQuery.dynamiclist");else return t.init.apply(this,arguments)},n.fn.dynamiclist.defaults={_mobile:typeof n.mobile!="undefined",itemSelector:".item",addLabel:"Additional",removeLabel:"Remove",htmlFieldPrefix:"",property:"Items",newItemUrl:"NewItem",listType:"list",itemAdded:function(){},itemRemoved:function(){}}})(jQuery)